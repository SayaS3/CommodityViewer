<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Commodity Page</title>
    <link rel="stylesheet" type="text/css" href="/styles.css">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/stock.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/moment.js"></script>
</head>

<body>

<section class="sidebar">
    <a href="#" class="logo">
        <span class="text">CommodityViewer</span>
    </a>

    <ul class="side-menu top">
        <li th:each="commodity : ${commodityTypes}"
            th:class="${#strings.equals(selectedCommodity, commodity)} ? 'active' : ''">
            <a th:href="@{'/' + ${commodity}}" class="nav-link">
                <span th:text="${commodity == 'MIEDZ' ? 'Miedź' :
                (commodity == 'ROPA' ? 'Ropa' :
                 (commodity == 'SREBRO' ? 'Srebro' :(commodity == 'PLATYNA' ? 'Platyna' :
                 (commodity == 'NIKIEL' ? 'Nikiel' :(commodity == 'CUKIER' ? 'Cukier' :
                 (commodity == 'SOJA' ? 'Soja' : (commodity == 'PALLAD' ? 'Pallad' :
                 (commodity == 'RZEPAK' ? 'Rzepak' : (commodity == 'KAWA' ? 'Kawa' :
                 (commodity == 'PSZENICA' ? 'Pszenica' : (commodity == 'ZLOTO' ? 'Złoto' :
                 (commodity == 'ALUMINIUM' ? 'Aluminium' : commodity))))))))))))}"></span>
            </a>
        </li>
    </ul>

    <ul class="side-menu">
        <li>
            <a href="#">
                <span class="text">Ustawienia</span>
            </a>
        </li>
        <li>
            <a href="#" class="logout">
                <span class="text">Wyloguj</span>
            </a>
        </li>
    </ul>
</section>
<section class="content">
    <nav>

        <form action="#">
            <div class="form-input">
                <input type="search" placeholder="search..." />
                <button class="search-btn">
                </button>
            </div>
        </form>

        <input type="checkbox" hidden id="switch-mode" />
        <label for="switch-mode" class="switch-mode"></label>


        <a href="#" class="profile">
            <img src="/profile.png" alt=""/>
        </a>
    </nav>
    <main>
        <div class="top-main">
            <h1>Panel</h1>
            <a href="#" class="download-btn">
                <span class="text">Pobierz raport</span>
            </a>
        </div>

        <div class="commodity-details">
            <a th:href="@{'/' + ${selectedCommodity.name} + '/testadf'}" class="btn">Test ADF</a>
            <a th:href="@{'/' + ${selectedCommodity.name} + '/forecasts'}" class="btn">Prognozy</a>
            <h3 th:text="${selectedCommodity.name}">Nazwa Surowca</h3>

            <p th:text="${'Interwał: dzienny'}"></p>
            <p th:text="${#strings.toString(currency) + '/' + #strings.toString(unit)}" class="commodity-info"></p>


        </div>
        <div class="holt-description">
            <p>
                Model prognozowania: Holt-Winters Forecast. Jest to zaawansowany model szeregów czasowych, wykorzystywany
                do prognozowania przyszłych cen surowców na podstawie ich historycznych danych. Model ten integruje trzy
                składowe: poziom (level), trend i sezonowość.
                Składowa poziomu odzwierciedla średnią wartość surowca, trend prognozuje kierunek i nachylenie zmian cen,
                natomiast składowa sezonowości uwzględnia cykliczne wzorce, które mogą występować w określonych okresach czasu,
                na przykład sezonowość roczna lub kwartalna
            </p>
        </div>

        <div id="myChart"></div>
        <th:block th:if="${#lists.size(forecasts) > 0}">

            <table class="table">
                <thead>
                <tr>
                    <th>Date</th>
                    <th>Forecast Value</th>
                    <!-- Dodaj inne nagłówki, jeśli są dostępne -->
                </tr>
                </thead>
                <tbody>
                <!-- Iteruj przez przewidywania i wyświetl wiersze tabeli -->
                <tr th:each="forecast : ${forecasts}">
                    <td th:text="${forecast.forecastDate}"></td>
                    <td th:text="${forecast.forecastValue}"></td>
                    <!-- Dodaj inne komórki, jeśli są dostępne -->
                </tr>
                </tbody>
            </table>
        </th:block>


    </main>

</section>

<script th:inline="javascript">
    let forecastDates = [[${forecastDates}]];
    let forecastValues = [[${forecastValues}]];
    let rawDates = [[${dates}]];
    let values = [[${values}]];
    // Przygotuj dane do wykresu
    let seriesData = [];
    for (let i = 0; i < rawDates.length; i++) {
        seriesData.push([new Date(rawDates[i]).getTime(), values[i]]);
    }

    let forecastData = [];
    for (let i = 0; i < forecastDates.length; i++) {
        forecastData.push([new Date(forecastDates[i]).getTime(), forecastValues[i]]);
    }

    // Utwórz obiekt konfiguracyjny dla wykresu
    let chartOptions = {
        chart: {
            type: 'line',
            zoomType: 'x', // Zaznaczanie i zoomowanie po osi X
        },
        title: {
            text: '',
        },
        xAxis: {
            type: 'datetime',
            labels: {
                formatter: function () {
                    return Highcharts.dateFormat('%e %b %Y', this.value); // Format daty na polski
                }
            },
        },
        yAxis: {
            title: {
                text: 'Cena',
            },
            labels: {
                formatter: function () {
                    return this.value.toString().replace('.', ','); // Zamień kropkę na przecinek
                }
            },
        },
        tooltip: {
            valueDecimals: 2,
            decimalPoint: ","
        },
        series: [
            {
                name: 'Ceny surowca',
                data: seriesData,
            },
            {
                name: 'Prognozowane ceny surowca',
                data: forecastData,
                color: 'orange', // Kolor dla wykresu prognozowanego
            }
        ],
        navigator: {
            enabled: true,
            series: {
                data: seriesData,
            },
        },
        rangeSelector: {
            buttons: [
                {
                    type: 'day',
                    count: 3,
                    text: '3D',
                },
                {
                    type: 'week',
                    count: 1,
                    text: '1W',
                },
                {
                    type: 'month',
                    count: 1,
                    text: '1M',
                },
                {
                    type: 'all',
                    text: 'All',
                },
            ],
            selected: 3,
        },
        legend: {
            enabled: true, // Włącz legendę
        },
        plotOptions: {
            series: {
                connectNulls: true, // Połącz null wartości w serii danych
            }
        },
    };
    Highcharts.setOptions({
        lang: {
            months: [
                'Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec',
                'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'
            ],
            shortMonths: [
                'Sty', 'Lut', 'Mar', 'Kwi', 'Maj', 'Cze',
                'Lip', 'Sie', 'Wrz', 'Paź', 'Lis', 'Gru'
            ],
            weekdays: [
                'Niedziela', 'Poniedziałek', 'Wtorek', 'Środa', 'Czwartek', 'Piątek', 'Sobota'
            ],
            shortWeekdays: [
                'Nd', 'Pn', 'Wt', 'Śr', 'Czw', 'Pt', 'Sob'
            ],
            legend: {
                navigation: {
                    enabled: true,
                },
                title: {
                    text: 'Legenda'
                }
            }
        }
    });
    // Utwórz wykres na podstawie konfiguracji
    let chart = Highcharts.stockChart('myChart', chartOptions);
</script>
<script th:inline="javascript" src="/app.js"></script>
</body>

</html>
